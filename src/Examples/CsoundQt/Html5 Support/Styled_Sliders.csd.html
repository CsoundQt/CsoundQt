<html>
<head>
<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script type="text/javascript">
"use strict";
document.addEventListener("DOMContentLoaded", function () {
    try {
        console.log("Initializing window.csound...");
        window.channel = new QWebChannel(qt.webChannelTransport, function(channel) {
        window.csound = channel.objects.csound;
        if (typeof window.csound === 'undefined') {
            alert('window.csound is undefined.');
            return;
        }
        if (window.csound === null) {
            alert('window.csound is null.');
            return;
        }
        csound.message("Initialized csound.\n");
        });
    } catch (e) {
        alert("initialize_csound error: " + e.message);
        console.log(e.message);
    }
});
</script>

</head>
<style type="text/css">
input[type='range'] {
    -webkit-appearance: none;
    border-radius: 5px;
    box-shadow: inset 0 0 5px #333;
    background-color: #999;
    height: 10px;
    width: 100%;
    vertical-align: middle;
}
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    border: none;
    height: 16px;
    width: 16px;
    border-radius: 50%;
    background: yellow;
    margin-top: -4px;
    border-radius: 10px;
}
table td {
    border-width: 2px;
    padding: 8px;
    border-style: solid;
    border-color: transparent;
    color:yellow;
    background-color: teal;
    font-family: sans-serif
}
</style>

<h1>Score Generator</h1>

<script>

var c = 0.99;
var y = 0.5;
function generate() {
    csound.message("generate()...\n");
    for (i = 0; i < 50; i++) {
      var t = i * (1.0 / 3.0);
      var y1 = 4.0 * c * y * (1.0 - y);
      y = y1;
      var key = Math.round(36.0 + (y * 60.0));
      var note = "i 1 " + t + " 2.0 " + key + " 60 0.0 0.5\n";
      csound.readScore(note);
    };
};

function on_sliderC(value) {
    c = parseFloat(value);
    document.querySelector('#sliderCOutput').value = c;
}

function on_sliderFmIndex(value) {
    var numberValue = parseFloat(value);
    document.querySelector('#sliderFmIndexOutput').value = numberValue;
    csound.setControlChannel('gk_FmIndex', numberValue);
}

function on_sliderFmRatio(value) {
    var numberValue = parseFloat(value);
    document.querySelector('#sliderFmRatioOutput').value = numberValue;
    csound.setControlChannel('gk_FmCarrier', numberValue);
}

function on_sliderReverberationDelay(value) {
    var numberValue = parseFloat(value);
    document.querySelector('#sliderReverberationDelayOutput').value = numberValue;
    csound.setControlChannel('gk_ReverberationDelay', numberValue);
}

function on_sliderMasterLevel(value) {
    var numberValue = parseFloat(value);
    document.querySelector('#sliderMasterLevelOutput').value = numberValue;
    csound.setControlChannel('gk_MasterLevel', numberValue);
}

</script>

<table>
<col width="2*">
<col width="5*">
<col width="100px">

<tr>
<td>
<label for=sliderC>c</label>
<td>
<input type=range min=0 max=1 value=.5 id=sliderC step=0.001 oninput="on_sliderC(value)">
<td>
<output for=sliderC id=sliderCOutput>.5</output>
</tr>

<tr>
<td>
<label for=sliderFmIndex>Frequency modulation index</label>
<td>
<input type=range min=0 max=1 value=.5 id=sliderC step=0.001 oninput="on_sliderFmIndex(value)">
<td>
<output for=sliderFmIndex id=sliderFmIndexOutput>.5</output>
</tr>

<tr>
<td>
<label for=sliderFmRatio>Frequency modulation ratio</label>
<td>
<input type=range min=0 max=1 value=.5 id=sliderFmRatio step=0.001 oninput="on_sliderFmRatio(value)">
<td>
<output for=sliderFmRatio id=sliderFmRatioOutput>.5</output>
</tr>

<tr>
<td>
<label for=sliderReverberationDelay>Reverberation delay</label>
<td>
<input type=range min=0 max=1 value=.5 id=sliderReverberationDelay step=0.001 oninput="on_sliderReverberationDelay(value)">
<td>
<output for=sliderReverberationDelay id=sliderReverberationDelayOutput>.5</output>
</tr>

<tr>
<td>
<label for=sliderMasterLevel>Master output level</label>
<td>
<input type=range min=0 max=1 value=.5 id=sliderMasterLevel step=0.001 oninput="on_sliderMasterLevel(value)">
<td>
<output for=sliderMasterLevel id=sliderMasterLevelOutput>.5</output>
</tr>

<tr>
<td>
<button onclick="generate()"> Generate score </button>
</td>
</tr>

</table>

</html>